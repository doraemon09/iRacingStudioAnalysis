<div id="telemetry_data" class="container-fluid" style="display: none;">
    <div class="row my-2">
        <div class="col-md-12">
            <button class="btn btn-info" onclick="showTelemetrySection('LapInfo')">
                <span>Lap Info</span>
            </button>
            {#
            {% for key in yaml_info['Telemetry'] %}
                <button class="btn btn-info" onclick="showTelemetrySection('{{ key }}')">
                    <span
                        data-en="{{ yaml_info['Telemetry'][key]['Label']['en'] }}"
                        data-jp="{{ yaml_info['Telemetry'][key]['Label']['jp'] }}"
                    >
                        {{ yaml_info['Telemetry'][key]['Label']['en'] }}
                    </span>
                </button>
            {% endfor%}
            #}
        </div>
    </div>

    <div id="LapInfo" class="row my-2" style="display: block;">
        <div class="col-md-12">
            <div class="row">
                <table class="table table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col">Lap No.</th>
                            <th scope="col">Lap Time</th>
                            <th scope="col">Delta (s)</th>
                            <th scope="col">Delta (%)</th>
                            <th scope="col">Lap Distance (km)</th>
                            <th scope="col">Speed (kph, Max)</th>
                            <th scope="col">Speed (kph, Avg)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for idx in lap_info %}
                            <tr>
                                <th scope="row">{{ idx.Lap }}</th>
                                <td
                                    {% if idx.IsBestLap or idx.IsWorstLap %}
                                        class="table-{% if idx.IsBestLap %}success{% elif idx.IsWorstLap %}danger{% endif %} fw-bold"
                                        style="border-color:revert;"
                                    {% endif %}
                                >
                                    {{ idx.LapTime | timeformat }}
                                </td>
                                <td>{{ idx.DeltaToBestLap | round(3) }}</td>
                                <td>{{ idx.DeltaToBestLapPercent | round() }}</td>
                                <td
                                    {% if idx.IsShortestLapDist or idx.IsLongestLapDist %}
                                        class="table-{% if idx.IsShortestLapDist %}success{% elif idx.IsLongestLapDist %}danger{% endif %} fw-bold"
                                        style="border-color:revert;"
                                    {% endif %}
                                >
                                    {{ idx.LapDist | to_km }}
                                </td>
                                <td
                                    {% if idx.IsBestMaxSpeed or idx.IsWorstMaxSpeed %}
                                        class="table-{% if idx.IsBestMaxSpeed %}success{% elif idx.IsWorstMaxSpeed %}danger{% endif %} fw-bold"
                                        style="border-color:revert;"
                                    {% endif %}
                                >
                                    {{ idx.SpeedMax | round(3) }}
                                </td>
                                <td
                                    {% if idx.IsBestAvgSpeed or idx.IsWorstAvgSpeed %}
                                        class="table-{% if idx.IsBestAvgSpeed %}success{% elif idx.IsWorstAvgSpeed %}danger{% endif %} fw-bold"
                                        style="border-color:revert;"
                                    {% endif %}
                                >
                                    {{ idx.SpeedAvg | round(3) }}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="row">
                <div id="lapTimeDistanceChart"></div>

                <!-- Ployly chart -->
                <script>
                    var lapData = {{ lap_info | tojson }};

                    var lapNumbers = lapData.map(function(data) { return data.Lap; });
                    var lapTimes = lapData.map(function(data) { return data.LapTime; });
                    var lapDistances = lapData.map(function(data) { return data.LapDist; });

                    var lapTimeDistance_trace1 = {
                        x: lapNumbers,
                        y: lapTimes,
                        type: 'scatter', // scatter plot or line chart
                        mode: 'lines+markers',
                        name: 'Lap Time',
                    };

                    var lapTimeDistance_trace2 = {
                        x: lapNumbers,
                        y: lapDistances,
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'Lap Distance (m)',
                        yaxis: 'y2', // Secondary y-axis for lap distances
                    };

                    var lapTimeDistance_layout = {
                        autosize: true,
                        title: 'Lap Times and Lap Distances',
                        xaxis: {
                            title: 'Lap Number',
                        },
                        yaxis: {
                            title: 'Lap Time (s)',
                        },
                        yaxis2: {
                            title: 'Lap Distance (m)',
                            overlaying: 'y',
                            side: 'right',
                        },
                    };

                    var lapTimeDistance_data = [lapTimeDistance_trace1, lapTimeDistance_trace2];

                    Plotly.newPlot('lapTimeDistanceChart', lapTimeDistance_data, lapTimeDistance_layout);
                </script>
            </div>
        </div>
    </div>
</div>
